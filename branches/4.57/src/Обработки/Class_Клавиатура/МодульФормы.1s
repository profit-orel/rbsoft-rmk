// онфигураци€ дл€ платформы "1—:ѕредпри€тие 7.7" –Ѕ-—офт:–абочее место кассира.
//¬ерси€ 4.43 от 19.07.10 20:54:19
//Ќазначение: јвтоматизаци€ POS-узлов в магазинах (Point of sale).
//(c) Ѕаинов ≈вгений, ќќќ "–Ѕ-—офт" 2006, г.”лан-”дэ, проспект 50-лети€ ќкт€бр€,21ј,офис 110 
//e-mail: bainov@rb-soft.ru  icq: 73718937, телефоны: (3012) 44-03-57, 44-76-42, 44-86-58
//---------------------------------------------------------------------------------------
//ƒанна€ программа €вл€етс€ свободным программным обеспечением.
//¬ы вправе распростран€ть ее и/или модифицировать в соответствии с услови€ми версии 2 
//либо по вашему выбору с услови€ми более поздней версии —тандартной ќбщественной Ћицензии GNU,
//опубликованной Free Software Foundation. 
//ћы распростран€ем данную программу в надежде на то, что она будет вам полезной, 
//однако Ќ≈ ѕ–≈ƒќ—“ј¬Ћя≈ћ Ќј Ќ≈≈ Ќ» ј »’ √ј–јЌ“»…, 
//в том числе √ј–јЌ“»» “ќ¬ј–Ќќ√ќ —ќ—“ќяЌ»я ѕ–» ѕ–ќƒј∆≈
//и ѕ–»√ќƒЌќ—“» ƒЋя »—ѕќЋ№«ќ¬јЌ»я ¬  ќЌ –≈“Ќџ’ ÷≈Ћя’.
//ƒл€ получени€ более подробной информации ознакомьтесь со —тандартной ќбщественной Ћицензией GNU.
//¬месте с данной программой вы должны были получить экземпл€р —тандартной ќбщественной Ћицензии GNU.
//≈сли вы его не получили, сообщите об этом в Free Software Foundation, Inc.,
//59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
//_______________________________________________________________________________________
//»м€ модул€:
// <¬ставить им€ модул€>
//_______________________________________________________________________________________
//–азработчик: Ѕаинов ≈вгений, e-mail: bainov@rb-soft.ru , icq: 73718937
//_______________________________________________________________________________________
//Ќазначение модул€:
// <¬ставить описание модул€>
//
//_______________________________________________________________________________________
ѕерем _Ѕаза Ёкспорт;

ѕерем Ќастройки лавиатуры Ёкспорт;//—сылка на класс .

ѕерем «адержка лавиатуры Ёкспорт;
ѕерем »м€‘айлаЌастройки лавиатуры Ёкспорт;

ѕерем Ѕуфер Ёкспорт;

ѕерем —ервис Ёкспорт;




ѕерем   —п÷ифры, —пЅуквы, —п«ап€тые, —п оманды экспорт;
ѕерем   —четчик лавиатуры экспорт;//врем€ последнего прин€того сканкода
ѕерем   „увствительность экспорт;



ѕерем  нопкаѕодбора“овара   экспорт,   нопкаѕодбораѕо оду    экспорт,   нопкаѕодбораѕојртикулу    экспорт,
 нопкаѕодбораѕоЎтрих оду    экспорт,   нопкаѕодбораѕо÷ене    экспорт,   нопкајктивации—трокиѕоиска экспорт,

 нопка«агрузкиƒанных   		экспорт,
 нопка¬ыбораƒисконта        экспорт,   нопкаќткрыти€ящика    экспорт,   нопкаЅлокировки             экспорт,
 нопка«абой                 экспорт,   нопкаќтмена           экспорт,   нопкаƒа                     экспорт,
 нопкаЌет                   экспорт,   нопка»тог             экспорт,   нопкаќтмены„ека             экспорт,
 нопка¬озврат               экспорт,   нопка оличество       экспорт,   нопка÷ена                   экспорт,
 нопка—кидка                экспорт,   нопкаЌадбавка         экспорт,   нопка00                     экспорт,
 нопка¬верх                  экспорт,  нопкаѕлюс1       экспорт,   нопкаћинус1       экспорт,
 нопка¬низ                  экспорт,   нопка¬лево            экспорт,   нопка¬право                 экспорт,
 нопка”далить—троку         экспорт,   нопка«акрытьѕрограмму экспорт,  //дл€ навигации в справочнике

 нопка_1          экспорт,  нопка_2           экспорт,   нопка_3                экспорт,   нопка_4         экспорт,
 нопка_5          экспорт,  нопка_6           экспорт,   нопка_7                экспорт,   нопка_8         экспорт,
 нопка_9          экспорт,  нопка_0           экспорт,   нопка«ап€та€           экспорт,
 нопка“аб          Ёкспорт,   нопкаќтменыјвтоскидок  Ёкспорт,  нопка∆урнал„еков Ёкспорт,
 нопкаѕечать опии Ёкспорт,  нопка¬вод—имволов Ёкспорт,
 нопка алькул€тор  Ёкспорт,	 нопка¬нешние„еки		Ёкспорт,  нопка¬изуального¬ыбора Ёкспорт;


ѕерем
 нопкаЌадбавка—уммой экспорт,  нопкаЌадбавкаЌаѕозицию экспорт,  нопкаЌадбавкаЌаѕозицию—уммой       экспорт,
 нопка—кидка—уммой   экспорт,  нопка—кидкаЌаѕозицию   экспорт,  нопка—кидкаЌаѕозицию—уммой         экспорт,
 нопка—траница¬низ   экспорт,  нопка—траница¬верх     экспорт,  нопка¬начало экспорт,  нопка¬ онец экспорт;



ѕерем  нопкаќплата Ёкспорт;


‘ункци€ Ётот( онт) 		¬озврат  онт; 			 онец‘ункции

‘ункци€ —ам() 			¬озврат Ётот( онтекст) 	 онец‘ункции


 //_____________________________________________________________________________

//Ќазначение:
//ѕараметры:
//
//
//¬озвращает:
//
‘ункци€ ѕолучить¬рем€ лавиатуры() экспорт
	возврат _GetPerformanceCounter()-—четчик лавиатуры;
 онец‘ункции //ѕолучить¬рем€ лавиатуры

//_____________________________________________________________________________
//ѕроцедура
//Ќазначение:
//
//ѕараметры:
//
//
ѕроцедура —бросить¬рем€ лавиатуры() экспорт
	—четчик лавиатуры=_GetPerformanceCounter();
 онецѕроцедуры //



ѕроцедура »нициализировать лавиатуру() Ёкспорт
	
	—пЅуквы=—оздатьќбъект("—писок«начений");
	спЅуквы.”становить("",0);
	»нд=0;
	—кан од=kbA;

	ƒл€ »нд= од—имв("a") по  од—имв("z") ÷икл
	    —имвол=¬–ег(—имв(»нд));
		—пЅуквы.”становить(—имвол,—кан од);
		—кан од=—кан од+1;
	 онец÷икла;



	—пЅуквы.”становить("Enter",kbEnter);
	—пЅуквы.”становить("Esc",kbEsc);
	—пЅуквы.”становить("NumLock",kbNumLock);
	—пЅуквы.”становить("Pad Plus",kbPadPlus);
	—пЅуквы.”становить("Pad Minus",kbPadMinus);
	—пЅуквы.”становить("Pad X",kbPadMul);
	—пЅуквы.”становить("Pad /",kbPadDiv);
	—пЅуквы.”становить("Pad .",kbPadPoint);
	—пЅуквы.”становить("Pad 0",kbPad0);
	—пЅуквы.”становить("Pad 1",kbPad1);
	—пЅуквы.”становить("Pad 2",kbPad2);
	—пЅуквы.”становить("Pad 3",kbPad3);
	—пЅуквы.”становить("Pad 4",kbPad4);
	—пЅуквы.”становить("Pad 5",kbPad5);
	—пЅуквы.”становить("Pad 6",kbPad6);
	—пЅуквы.”становить("Pad 7",kbPad7);
	—пЅуквы.”становить("Pad 8",kbPad8);
	—пЅуквы.”становить("Pad 9",kbPad9);
	—пЅуквы.”становить("0",kb0);
	—пЅуквы.”становить("1",kb1);
	—пЅуквы.”становить("2",kb2);
	—пЅуквы.”становить("3",kb3);
	—пЅуквы.”становить("4",kb4);
	—пЅуквы.”становить("5",kb5);
	—пЅуквы.”становить("6",kb6);
	—пЅуквы.”становить("7",kb7);
	—пЅуквы.”становить("8",kb8);
	—пЅуквы.”становить("9",kb9);
	—пЅуквы.”становить("Scroll",kbScroll);
	—пЅуквы.”становить("Pause",kbPause);
	—пЅуквы.”становить("Prn Screen",kbPrnScr);
	—пЅуквы.”становить("LeftWin",kbLeftWin);
	—пЅуквы.”становить("RightWin",kbRightWin);
	—пЅуквы.”становить("Property",kbProperty);
	—пЅуквы.”становить("CapsLock",kbCapsLock);
	—пЅуквы.”становить("Tab",kbTab);
	—пЅуквы.”становить("Left",kbLeft);
	—пЅуквы.”становить("Right",kbRight);
	—пЅуквы.”становить("Up",kbUp);
	—пЅуквы.”становить("Down",kbDown);
	—пЅуквы.”становить("PgUp",kbPgUp);
	—пЅуквы.”становить("PgDn",kbPgDn);
	—пЅуквы.”становить("Delete",kbDelete);
	—пЅуквы.”становить("Insert",kbInsert);
	—пЅуквы.”становить("Home",kbHome);
	—пЅуквы.”становить("End",kbEnd);
	—пЅуквы.”становить("BackSpace",kbBackSpace);
	—пЅуквы.”становить("ѕробел",kbSpace);
	—пЅуквы.”становить("F1",kbF1);
	—пЅуквы.”становить("F2",kbF2);
	—пЅуквы.”становить("F3",kbF3);
	—пЅуквы.”становить("F4",kbF4);
	—пЅуквы.”становить("F5",kbF5);
	—пЅуквы.”становить("F6",kbF6);
	—пЅуквы.”становить("F7",kbF7);
	—пЅуквы.”становить("F8",kbF8);
	—пЅуквы.”становить("F9",kbF9);
	—пЅуквы.”становить("F10",kbF10);
	—пЅуквы.”становить("F11",kbF11);
	—пЅуквы.”становить("F12",kbF12);

	—пЅуквы.”становить("~",kb¬олна);
	—пЅуквы.”становить("[",kbЋева€—кобка);
	—пЅуквы.”становить("]",kbѕрава€—кобка);
	—пЅуквы.”становить(":",kbƒвоеточие);
	—пЅуквы.”становить("""",kb авычка);
	—пЅуквы.”становить("|",kb¬ертикальна€ѕолоса);
	—пЅуквы.”становить("\",kbќбратный—лэш);
	—пЅуквы.”становить(",",kb«ап€та€);
	—пЅуквы.”становить(".",kb“очка);
	—пЅуквы.”становить("/",kb—лэш);
	—пЅуквы.”становить("-",kbћинус);
	—пЅуквы.”становить("=",kb–авно);

	 оличество«начений=—пЅуквы.–азмер—писка();
	ƒл€ »нд=1 ѕо  оличество«начений ÷икл

		—имвол="";
		—кан од=—пЅуквы.ѕолучить«начение(»нд,—имвол);

		—пЅуквы.”становить("Alt+"+—имвол,kbAltFlag+—кан од);
		—пЅуквы.”становить("Ctrl+"+—имвол,kbCtrlFlag+—кан од);
		—пЅуквы.”становить("Shift+"+—имвол,kbShiftFlag+—кан од);
		—пЅуквы.”становить("Ctrl+Alt+"+—имвол,kbCtrlFlag+kbAltFlag+—кан од);
		—пЅуквы.”становить("Ctrl+Shift+"+—имвол,kbCtrlFlag+kbShiftFlag+—кан од);
		—пЅуквы.”становить("Alt+Shift+"+—имвол,kbAltFlag+kbShiftFlag+—кан од);

	 онец÷икла;

	—пЅуквы.”становить("Ctrl",kbCtrl);
	—пЅуквы.”становить("Alt",kbAlt);
	—пЅуквы.”становить("Shift",kbShift);

	CR = —имв(13)+—имв(10);

 онецѕроцедуры



ѕроцедура ƒеструктор()

 онецѕроцедуры // ƒеструктор


ѕроцедура ѕодготовитьƒанные «аписи() Ёкспорт
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_1", нопка_1);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_2", нопка_2);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_3", нопка_3);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_4", нопка_4);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_5", нопка_5);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_6", нопка_6);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_7", нопка_7);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_8", нопка_8);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_9", нопка_9);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_0", нопка_0);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷»‘–ј_00", нопка00);

	Ќастройки лавиатуры.”становить("KEYTABLE/«јѕя“јя", нопка«ап€та€);


	Ќастройки лавиатуры.”становить("KEYTABLE/ѕќƒЅќ–_“ќ¬ј–ј", нопкаѕодбора“овара);
	Ќастройки лавиатуры.”становить("KEYTABLE/ѕќƒЅќ–_ѕќ_ ќƒ”", нопкаѕодбораѕо оду);
	Ќастройки лавиатуры.”становить("KEYTABLE/ѕќƒЅќ–_ѕќ_ј–“» ”Ћ”", нопкаѕодбораѕојртикулу);
	Ќастройки лавиатуры.”становить("KEYTABLE/ѕќƒЅќ–_ѕќ_÷≈Ќ≈", нопкаѕодбораѕо÷ене);
	Ќастройки лавиатуры.”становить("KEYTABLE/ѕќƒЅќ–_ѕќ_Ў“–»’ ќƒ”", нопкаѕодбораѕоЎтрих оду);

	Ќастройки лавиатуры.”становить("KEYTABLE/¬»«”јЋ№Ќџ…_¬џЅќ–", нопка¬изуального¬ыбора);
	Ќастройки лавиатуры.”становить("KEYTABLE/ј “»¬ј÷»я_—“–ќ »_ѕќ»— ј", нопкајктивации—трокиѕоиска);

	Ќастройки лавиатуры.”становить("KEYTABLE/ѕЋё—_1", нопкаѕлюс1);
	Ќастройки лавиатуры.”становить("KEYTABLE/ћ»Ќ”—_1", нопкаћинус1);


	Ќастройки лавиатуры.”становить("KEYTABLE/ ќЋ»„≈—“¬ќ", нопка оличество);
	Ќастройки лавиатуры.”становить("KEYTABLE/”ƒјЋ»“№_—“–ќ ”", нопка”далить—троку);
	Ќастройки лавиатуры.”становить("KEYTABLE/÷≈Ќј", нопка÷ена);
	Ќастройки лавиатуры.”становить("KEYTABLE/— »ƒ ј", нопка—кидка);
	Ќастройки лавиатуры.”становить("KEYTABLE/ƒ»— ќЌ“", нопка¬ыбораƒисконта);
	Ќастройки лавиатуры.”становить("KEYTABLE/ќ“ –џ“№_яў» ", нопкаќткрыти€ящика);
	Ќастройки лавиатуры.”становить("KEYTABLE/ЅЋќ »–ќ¬ ј", нопкаЅлокировки);
	Ќастройки лавиатуры.”становить("KEYTABLE/EDIT_«јЅќ…", нопка«абой);
	Ќастройки лавиатуры.”становить("KEYTABLE/EDIT_ќ“ћ≈Ќј", нопкаќтмена);
	Ќастройки лавиатуры.”становить("KEYTABLE/ƒј", нопкаƒа);
	Ќастройки лавиатуры.”становить("KEYTABLE/Ќ≈“", нопкаЌет);

	Ќастройки лавиатуры.”становить("KEYTABLE/ѕ–ќЅ»“№_„≈ ", нопка»тог);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬ќ«¬–ј“", нопка¬озврат);
	Ќастройки лавиатуры.”становить("KEYTABLE/ќ“ћ≈Ќј_„≈ ј", нопкаќтмены„ека);


	Ќастройки лавиатуры.”становить("KEYTABLE/¬џЅќ–_ќѕЋј“џ", нопкаќплата);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬џЅќ–_¬Ќ≈ЎЌ≈√ќ_„≈ ј", нопка¬нешние„еки);


	Ќастройки лавиатуры.”становить("KEYTABLE/¬¬≈–’", нопка¬верх);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬Ќ»«", нопка¬низ);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬ѕ–ј¬ќ", нопка¬право);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬Ћ≈¬ќ", нопка¬лево);
	Ќастройки лавиатуры.”становить("KEYTABLE/—“–јЌ»÷ј_¬Ќ»«", нопка—траница¬низ);
	Ќастройки лавиатуры.”становить("KEYTABLE/—“–јЌ»÷ј_¬¬≈–’", нопка—траница¬верх);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬_Ќј„јЋќ", нопка¬начало);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬_ ќЌ≈÷", нопка¬ онец);

	Ќастройки лавиатуры.”становить("KEYTABLE/“јЅ”Ћя÷»я", нопка“аб);

	Ќастройки лавиатуры.”становить("KEYTABLE/ќ“ћ≈Ќј_ј¬“ќ— »ƒќ ", нопкаќтменыјвто—кидок);
	Ќастройки лавиатуры.”становить("KEYTABLE/∆”–ЌјЋ_„≈ ќ¬", нопка∆урнал„еков);
	Ќастройки лавиатуры.”становить("KEYTABLE/ѕ≈„ј“№_ ќѕ»»", нопкаѕечать опии);
	Ќастройки лавиатуры.”становить("KEYTABLE/¬¬ќƒ_—»ћ¬ќЋќ¬", нопка¬вод—имволов);

	Ќастройки лавиатуры.”становить("KEYTABLE/ јЋ№ ”Ћя“ќ–", нопка алькул€тор);

	Ќастройки лавиатуры.”становить("KEYTABLE/ЌјƒЅј¬ ј", нопкаЌадбавка);
	Ќастройки лавиатуры.”становить("KEYTABLE/ЌјƒЅј¬ ј_—”ћћќ…", нопкаЌадбавка—уммой);
	Ќастройки лавиатуры.”становить("KEYTABLE/ЌјƒЅј¬ ј_Ќј_ѕќ«»÷»ё", нопкаЌадбавкаЌаѕозицию);
	Ќастройки лавиатуры.”становить("KEYTABLE/ЌјƒЅј¬ ј_Ќј_ѕќ«»÷»ё_—”ћћќ…", нопкаЌадбавкаЌаѕозицию—уммой);
	Ќастройки лавиатуры.”становить("KEYTABLE/— »ƒ ј_—”ћћќ…", нопка—кидка—уммой);
	Ќастройки лавиатуры.”становить("KEYTABLE/— »ƒ ј_Ќј_ѕќ«»÷»ё", нопка—кидкаЌаѕозицию);
	Ќастройки лавиатуры.”становить("KEYTABLE/— »ƒ ј_Ќј_ѕќ«»÷»ё_—”ћћќ…", нопка—кидкаЌаѕозицию—уммой);

	Ќастройки лавиатуры.”становить("KEYTABLE/«ј –џ“№_ѕ–ќ√–јћћ”", нопка«акрытьѕрограмму);



 онецѕроцедуры


ѕроцедура »нициализировать»зЌастроек() Ёкспорт


	 нопка_1=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_1");
	 нопка_2=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_2");
	 нопка_3=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_3");
	 нопка_4=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_4");
	 нопка_5=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_5");
	 нопка_6=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_6");
	 нопка_7=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_7");
	 нопка_8=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_8");
	 нопка_9=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_9");
	 нопка_0=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_0");
	 нопка00=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷»‘–ј_00");

	 нопка«ап€та€=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/«јѕя“јя");


	—п оманды=—оздатьќбъект("—писок«начений");


	 нопкаѕодбора“овара=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕќƒЅќ–_“ќ¬ј–ј");
	 нопкаѕодбораѕо оду=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕќƒЅќ–_ѕќ_ ќƒ”");
	 нопкаѕодбораѕојртикулу=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕќƒЅќ–_ѕќ_ј–“» ”Ћ”");
	 нопкаѕодбораѕо÷ене=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕќƒЅќ–_ѕќ_÷≈Ќ≈");
	 нопкаѕодбораѕоЎтрих оду=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕќƒЅќ–_ѕќ_Ў“–»’ ќƒ”");

	—п оманды.”становить("ѕќƒЅќ–_“ќ¬ј–ј", нопкаѕодбора“овара);
	—п оманды.”становить("ѕќƒЅќ–_ѕќ_ ќƒ”", нопкаѕодбораѕо оду);
	—п оманды.”становить("ѕќƒЅќ–_ѕќ_ј–“» ”Ћ”", нопкаѕодбораѕојртикулу);
	—п оманды.”становить("ѕќƒЅќ–_ѕќ_÷≈Ќ≈", нопкаѕодбораѕо÷ене);
	—п оманды.”становить("ѕќƒЅќ–_ѕќ_Ў“–»’ ќƒ”", нопкаѕодбораѕоЎтрих оду);


	 нопка¬изуального¬ыбора=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬»«”јЋ№Ќџ…_¬џЅќ–");
	 нопкајктивации—трокиѕоиска=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ј “»¬ј÷»я_—“–ќ »_ѕќ»— ј");

	—п оманды.”становить("¬»«”јЋ№Ќџ…_¬џЅќ–", нопка¬изуального¬ыбора);
	—п оманды.”становить("ј “»¬ј÷»я_—“–ќ »_ѕќ»— ј", нопкајктивации—трокиѕоиска);


	 нопкаѕлюс1=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕЋё—_1");
	 нопкаћинус1=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ћ»Ќ”—_1");
	 нопка оличество=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ ќЋ»„≈—“¬ќ");
	 нопка”далить—троку=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/”ƒјЋ»“№_—“–ќ ”");
	 нопка÷ена=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/÷≈Ќј");
	 нопка—кидка=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/— »ƒ ј");
	 нопка¬ыбораƒисконта=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ƒ»— ќЌ“");
	 нопкаќткрыти€ящика=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ќ“ –џ“№_яў» ");
	 нопкаЅлокировки=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ЅЋќ »–ќ¬ ј");
	 нопка«абой=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/EDIT_«јЅќ…");
	 нопкаќтмена=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/EDIT_ќ“ћ≈Ќј");
	 нопкаƒа=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ƒј");
	 нопкаЌет=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/Ќ≈“");

	—п оманды.”становить("ѕЋё—_1", нопкаѕлюс1);
	—п оманды.”становить("ћ»Ќ”—_1", нопкаћинус1);
	—п оманды.”становить(" ќЋ»„≈—“¬ќ", нопка оличество);
	—п оманды.”становить("”ƒјЋ»“№_—“–ќ ”", нопка”далить—троку);
	—п оманды.”становить("÷≈Ќј", нопка÷ена);
	—п оманды.”становить("— »ƒ ј", нопка—кидка);
	—п оманды.”становить("ƒ»— ќЌ“", нопка¬ыбораƒисконта);
	—п оманды.”становить("ќ“ –џ“№_яў» ", нопкаќткрыти€ящика);
	—п оманды.”становить("ЅЋќ »–ќ¬ ј", нопкаЅлокировки);
	—п оманды.”становить("EDIT_«јЅќ…", нопка«абой);
	—п оманды.”становить("EDIT_ќ“ћ≈Ќј", нопкаќтмена);
	—п оманды.”становить("ƒј", нопкаƒа);
	—п оманды.”становить("Ќ≈“", нопкаЌет);


	 нопка»тог=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕ–ќЅ»“№_„≈ ");
	 нопка¬озврат=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬ќ«¬–ј“");
	 нопкаќтмены„ека=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ќ“ћ≈Ќј_„≈ ј");

	—п оманды.”становить("ѕ–ќЅ»“№_„≈ ", нопка»тог);
	—п оманды.”становить("¬ќ«¬–ј“", нопка¬озврат);
	—п оманды.”становить("ќ“ћ≈Ќј_„≈ ј", нопкаќтмены„ека);


	 нопкаќплата=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬џЅќ–_ќѕЋј“џ");
	 нопка¬нешние„еки=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬џЅќ–_¬Ќ≈ЎЌ≈√ќ_„≈ ј");

	—п оманды.”становить("¬џЅќ–_ќѕЋј“џ", нопкаќплата);
	—п оманды.”становить("¬џЅќ–_¬Ќ≈ЎЌ≈√ќ_„≈ ј", нопка¬нешние„еки);

	 нопка¬верх=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬¬≈–’");
	 нопка¬низ=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬Ќ»«");
	 нопка¬право=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬ѕ–ј¬ќ");
	 нопка¬лево=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬Ћ≈¬ќ");
	 нопка—траница¬низ=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/—“–јЌ»÷ј_¬Ќ»«");
	 нопка—траница¬верх=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/—“–јЌ»÷ј_¬¬≈–’");
	 нопка¬начало=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬_Ќј„јЋќ");
	 нопка¬ онец=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬_ ќЌ≈÷");

	—п оманды.”становить("¬¬≈–’", нопка¬верх);
	—п оманды.”становить("¬Ќ»«", нопка¬низ);
	—п оманды.”становить("¬ѕ–ј¬ќ", нопка¬право);
	—п оманды.”становить("¬Ћ≈¬ќ", нопка¬лево);
	—п оманды.”становить("—“–јЌ»÷ј_¬Ќ»«", нопка—траница¬низ);
	—п оманды.”становить("—“–јЌ»÷ј_¬¬≈–’", нопка—траница¬верх);
	—п оманды.”становить("¬_Ќј„јЋќ", нопка¬начало);
	—п оманды.”становить("¬_ ќЌ≈÷", нопка¬ онец);

	 нопка“аб=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/“јЅ”Ћя÷»я");

	—п оманды.”становить("“јЅ”Ћя÷»я", нопка“аб);

	 нопкаќтменыјвто—кидок=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ќ“ћ≈Ќј_ј¬“ќ— »ƒќ ");
	 нопка∆урнал„еков=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/∆”–ЌјЋ_„≈ ќ¬");
	 нопкаѕечать опии=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ѕ≈„ј“№_ ќѕ»»");
	 нопка¬вод—имволов=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/¬¬ќƒ_—»ћ¬ќЋќ¬");

	—п оманды.”становить("ќ“ћ≈Ќј_ј¬“ќ— »ƒќ ", нопкаќтменыјвто—кидок);
	—п оманды.”становить("∆”–ЌјЋ_„≈ ќ¬", нопка∆урнал„еков);
	—п оманды.”становить("ѕ≈„ј“№_ ќѕ»»", нопкаѕечать опии);
	—п оманды.”становить("¬¬ќƒ_—»ћ¬ќЋќ¬", нопка¬вод—имволов);


	 нопка алькул€тор=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ јЋ№ ”Ћя“ќ–");

	—п оманды.”становить(" јЋ№ ”Ћя“ќ–", нопка алькул€тор);

	 нопкаЌадбавка=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ЌјƒЅј¬ ј");
	 нопкаЌадбавка—уммой=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ЌјƒЅј¬ ј_—”ћћќ…");
	 нопкаЌадбавкаЌаѕозицию=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ЌјƒЅј¬ ј_Ќј_ѕќ«»÷»ё");
	 нопкаЌадбавкаЌаѕозицию—уммой=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/ЌјƒЅј¬ ј_Ќј_ѕќ«»÷»ё_—”ћћќ…");
	 нопка—кидка—уммой=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/— »ƒ ј_—”ћћќ…");
	 нопка—кидкаЌаѕозицию=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/— »ƒ ј_Ќј_ѕќ«»÷»ё");
	 нопка—кидкаЌаѕозицию—уммой=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/— »ƒ ј_Ќј_ѕќ«»÷»ё_—”ћћќ…");


	—п оманды.”становить("ЌјƒЅј¬ ј", нопкаЌадбавка);
	—п оманды.”становить("ЌјƒЅј¬ ј_—”ћћќ…", нопкаЌадбавка—уммой);
	—п оманды.”становить("ЌјƒЅј¬ ј_Ќј_ѕќ«»÷»ё", нопкаЌадбавкаЌаѕозицию);
	—п оманды.”становить("ЌјƒЅј¬ ј_Ќј_ѕќ«»÷»ё_—”ћћќ…", нопкаЌадбавкаЌаѕозицию—уммой);
	—п оманды.”становить("— »ƒ ј_—”ћћќ…", нопка—кидка—уммой);
	—п оманды.”становить("— »ƒ ј_Ќј_ѕќ«»÷»ё", нопка—кидкаЌаѕозицию);
	—п оманды.”становить("— »ƒ ј_Ќј_ѕќ«»÷»ё_—”ћћќ…", нопка—кидкаЌаѕозицию—уммой);


	 нопка«акрытьѕрограмму=Ќастройки лавиатуры.ѕолучить ак„исло("KEYTABLE/«ј –џ“№_ѕ–ќ√–јћћ”");
	—п оманды.”становить("«ј –џ“№_ѕ–ќ√–јћћ”", нопка«акрытьѕрограмму);


 онецѕроцедуры

‘ункци€ «агрузить–аскладку лавиатуры (»м€‘айлаЌастройки лавиатуры) экспорт


	≈сли Ќастройки лавиатуры.ѕрочитать‘айл(»м€‘айлаЌастройки лавиатуры)=0 “огда
		—ам().”становитьќшибку("Ќе удалось прочитать раскладку клавиатуры!
		|"+Ќастройки лавиатуры.ѕоследн€€ќшибка());

		глѕредупреждение(—ам().ѕоследн€€ќшибка());
		возврат 0;
	 онец≈сли;


	»нициализировать»зЌастроек();



	—екци€“оваров=Ќастройки лавиатуры.ѕолучить—екцию("GOODS");
	≈сли ѕустое«начение(—екци€“оваров)=0 “огда
		//есть описание быстрого подбора товаров по гор€чим клавишам

		 од нопки=""; оды“оваров="";
		—екци€“оваров.¬ыбрать—войства();
		ѕока —екци€“оваров.ѕолучить—войство( од нопки, оды“оваров)=1 ÷икл

		 онец÷икла;

	 онец≈сли;


	—п÷ифры=—оздатьќбъект("—писок«начений");
	—п÷ифры.ƒобавить«начение( нопка_0,"0");
	—п÷ифры.ƒобавить«начение( нопка_1,"1");
	—п÷ифры.ƒобавить«начение( нопка_2,"2");
	—п÷ифры.ƒобавить«начение( нопка_3,"3");
	—п÷ифры.ƒобавить«начение( нопка_4,"4");
	—п÷ифры.ƒобавить«начение( нопка_5,"5");
	—п÷ифры.ƒобавить«начение( нопка_6,"6");
	—п÷ифры.ƒобавить«начение( нопка_7,"7");
	—п÷ифры.ƒобавить«начение( нопка_8,"8");
	—п÷ифры.ƒобавить«начение( нопка_9,"9");
	—п÷ифры.ƒобавить«начение( нопка00,"00");
	—п«ап€тые=—оздатьќбъект("—писок«начений");
	—п«ап€тые.ƒобавить«начение( нопка«ап€та€,".");


	возврат 1;
 онец‘ункции // «агрузить–аскладку лавиатуры

//_____________________________________________________________________________
//‘ункци€
//Ќазначение:
//преобразование любой комбинации клавиш в унифицированное число однозначно определ€ющее комбинацию кнопок
//ѕараметры:
//
//
//¬озвращает:
//
‘ункци€ ѕолучить од лавиши(п од лавиши,Alt,Shift,Ctrl) экспорт
    возврат п од лавиши+Alt*kbAltFlag+Ctrl*kbCtrlFlag+Shift*kbShiftFlag;
 онец‘ункции //

//ѕо коду нажатой клавиши (или комбинации) определ€ет соответствуюший по раскладке символ

‘ункци€ ѕолучить—имвол( од) экспорт
ѕерем —тр,»нд;
	—тр="";
	»нд=—п÷ифры.Ќайти«начение( од);
	≈сли »нд>0 “огда
		—п÷ифры.ѕолучить«начение(»нд,—тр);

	»наче
		»нд=—п«ап€тые.Ќайти«начение( од);
		≈сли »нд>0 “огда
			—п«ап€тые.ѕолучить«начение(»нд,—тр);
			возврат —тр;
		 онец≈сли;

		»нд=спЅуквы.Ќайти«начение( од);
		≈сли »нд>0 “огда
			спЅуквы.ѕолучить«начение(»нд,—тр);
		 онец≈сли;
	 онец≈сли;
	возврат —тр;
 онец‘ункции // ѕолучить—имвол


‘ункци€ Ёто÷ифра( од) Ёкспорт
	≈сли “ип«начени€—тр( од)="„исло" “огда
		возврат —п÷ифры.ѕринадлежит( од);
	»наче≈сли “ип«начени€—тр( од)="—трока" “огда
		≈сли —трƒлина( од)=1 “огда
			≈сли Ќайти("01234546789", од)>0 “огда
				возврат 1;
			 онец≈сли;
		»наче≈сли  од="00" “огда
			возврат 1;
		 онец≈сли;
	 онец≈сли;
	возврат 0;
 онец‘ункции // Ёто÷ифра


‘ункци€ ѕолучить оманду–едактора—троки( од) Ёкспорт
	≈сли  од= нопка«абой “огда
		возврат "EDIT_«јЅќ…";
	»наче≈сли  од= нопка«ап€та€ “огда
		возврат "«ап€та€";
	»наче≈сли  од= нопка00 “огда
		возврат "00";
	 онец≈сли;
	возврат "";
 онец‘ункции

//ѕо коду кнопки  од возвращает идентификатор команды.

‘ункци€ ѕолучить оманду( од,–ежим="") Ёкспорт

	 оманда="";
	ѕоз=—п оманды.Ќайти«начение( од);
	≈сли ѕоз>0 “огда

		—п оманды.ѕолучить«начение(ѕоз, оманда);
		¬озврат  оманда;
	 онец≈сли;

	возврат "";
 онец‘ункции

‘ункци€ —оздать—обытие(п онтекст,»м€ онтекста,п од лавиши,Alt,Shift,Ctrl) Ёкспорт

	—ам=—ам();
	—обытие=Ќовыйќбъект("—обытие");

	—обытие.»сточник=" лавиатура";
	—обытие.ƒанныеƒрайвера=Ќовыйќбъект("—труктураƒанныхƒрайвера");
	—обытие.ƒанныеƒрайвера.»сточник=" лавиатура";
	—обытие.ƒанныеƒрайвера.—обытие="Ќажатие";
	—обытие.ƒанныеƒрайвера.ƒанные=глƒрайверы. лавиатура.ѕолучить од лавиши(п од лавиши,Alt,Shift,Ctrl);



	—обытие.ќписатель=Ќовыйќбъект("ќписатель—обыти€ лавиатуры");

	—обытие.ќписатель.»м€ онтекста=»м€ онтекста;

	—обытие.ќписатель. од лавиши=п од лавиши;
	—обытие.ќписатель.Alt=Alt;
	—обытие.ќписатель.Shift=Shift;
	—обытие.ќписатель.Ctrl=Ctrl;
	—обытие.ќписатель.ƒанные=—обытие.ƒанныеƒрайвера.ƒанные;
	—обытие.ќписатель.—имвол=—ам.ѕолучить—имвол(—обытие.ƒанныеƒрайвера.ƒанные);

	возврат —обытие;
 онец‘ункции


‘ункци€ ѕредставление нопки( од) Ёкспорт
	ѕерем —тр,»нд, од нопки,флаги,—трока‘лаг;
	—тр="";

	»нд=спЅуквы.Ќайти«начение( од);
	≈сли »нд>0 “огда
		спЅуквы.ѕолучить«начение(»нд,—тр);
	»наче

		≈сли  од>kbAltFlag “огда
			флаги=÷ел( од/kbAltFlag)*kbAltFlag;
			 од нопки= од-флаги;
			—трока‘лаг="";
			≈сли флаги=kbAltFlag “огда
				—трока‘лаг="Alt+";
			»наче≈сли флаги=kbCtrlFlag “огда
				—трока‘лаг="Ctrl+";
			»наче≈сли флаги=kbShiftFlag “огда
				—трока‘лаг="Shift+";
			»наче≈сли флаги=kbCtrlFlag+kbShiftFlag “огда
				—трока‘лаг="Ctrl+Shift+";
			»наче≈сли флаги=kbAltFlag+kbShiftFlag “огда
				—трока‘лаг="Alt+Shift+";
			»наче≈сли флаги=kbCtrlFlag+kbAltFlag “огда
				—трока‘лаг="Ctrl+Alt+";
			 онец≈сли;
			¬озврат —трока‘лаг+ѕредставление нопки( од нопки);
		 онец≈сли;
		—тр="#"+ од;
	 онец≈сли;
	¬озврат —тр;

 онец‘ункции



ѕроцедура  онструктор()
     _Ѕаза = Ётот( онтекст).ѕолучитьЅазовый ласс("ќбъект");

	 „увствительность=100;
	 —четчик лавиатуры=0;

	 «адержка лавиатуры=80;


	 «начение=глЌастройки.ѕолучить("KEYBOARD/SENS");
	 ≈сли ѕустое«начение(«начение)=0 “огда
		«адержка лавиатуры=„исло(«начение);
	  онец≈сли;  //ѕустое«начение(«начение)=1

	 «начение=глЌастройки.ѕолучить("KEYBOARD/LAYOUT");
	≈сли ѕустое«начение(«начение)=0 “огда
		»м€‘айлаЌастройки лавиатуры=глќбработатьћакро—троку(«начение);
	 онец≈сли;  //ѕустое«начение(«начение)=1


	Ќастройки лавиатуры=—оздатьќбъект("‘айл.INI");
	»нициализировать лавиатуру();

	Ѕуфер			=	Ќовыйќбъект("Ѕуфер лавиатуры");

	≈сли «агрузить–аскладку лавиатуры(»м€‘айлаЌастройки лавиатуры)=0 “огда
		//#curmeth
		//#error ќшибка загрузки раскладки клавиатуры
	 онец≈сли;  //гл«агрузить–аскладку лавиатуры(“екстќшибки)=1

	 —ервис=—оздатьќбъект("—ервис");
	 —бросить¬рем€ лавиатуры();
 онецѕроцедуры //  онструктор


ѕроцедура ƒобавить¬Ѕуфер(»м€ онтекста, од лавиши,Alt,Shift,Ctrl) Ёкспорт
	—ам=—ам();

	≈сли ( од лавиши=kbAlt)»ли( од лавиши=kbShift)»ли( од лавиши=kbCtrl) “огда
		—бросить¬рем€ лавиатуры();
		//—ам.¬ключитьѕроверку лавиатуры();
		возврат;
	 онец≈сли;  //

	Ѕуфер.Ќова€—трока();
	Ѕуфер. од лавиши= од лавиши;
	Ѕуфер.Alt=Alt;
	Ѕуфер.Shift=Shift;
	Ѕуфер.Ctrl=Ctrl;
	Ѕуфер.¬рем€=_GetPerformanceCounter();
	Ѕуфер.»нтервал=ѕолучить¬рем€ лавиатуры();
	Ѕуфер.»м€ онтекста=»м€ онтекста;

	—бросить¬рем€ лавиатуры();

	—ам.¬ключитьѕроверку лавиатуры();

 онецѕроцедуры

ѕроцедура ќчиститьЅуфер() Ёкспорт
	Ѕуфер.”далить—троки();
	—бросить¬рем€ лавиатуры();
 онецѕроцедуры


//„итаем буфер.
//ѕоследовательные строки с малым интервалом (меньше, чем порог чувствительности клавиатуры)
//считаем пришедшими от устройства
//≈сли таких событий не больше 4, считаем что это программируема€ клавиатура, в учет берем последнюю кнопку
//≈сли больше, то игнорируем.
//ѕотом можно сделать анализатор и генерацию событий от клавиатурного сканера и ридера, и обходитьс€ без драйвера јтол
ѕроцедура ќбработка лавиатуры() Ёкспорт

	—ам=—ам();


	≈сть нопка–едактировани€=0;

	≈сли Ѕуфер. оличество—трок()>0 “огда
		Ѕуфер.¬начало();

		 од омбинации=—ам.ѕолучить од лавиши(Ѕуфер. од лавиши,Ѕуфер.Alt,Ѕуфер.Shift,Ѕуфер.Ctrl);

		—п=—оздатьќбъект("—писок«начений");
		—п.ƒобавить«начение( нопка«абой);
		—п.ƒобавить«начение( нопка¬верх);
		—п.ƒобавить«начение( нопка¬низ);
		—п.ƒобавить«начение( нопка¬право);
		—п.ƒобавить«начение( нопка¬лево);
		—п.ƒобавить«начение( нопка¬ онец);
		—п.ƒобавить«начение( нопка—траница¬верх);
		—п.ƒобавить«начение( нопка—траница¬низ);

		≈сли —п.ѕринадлежит( од омбинации)=1 “огда
			≈сть нопка–едактировани€=1;
		 онец≈сли;

	 онец≈сли;

	≈сли (ѕолучить¬рем€ лавиатуры()<«адержка лавиатуры)»(≈сть нопка–едактировани€=0) “огда
		//∆дем окончани€ серии нажатий, только если это не BackSpace

		¬озврат;
	 онец≈сли;


	//сюда попали только в случае, когда с момента последнего клавиатурного нажати€ прошло врем€ задержки
	//значит кончилс€ ввод серии нажатий от клавиатурного устойства

	//сери€ у нас лежит в буфере

	—ам.ќтключитьѕроверку лавиатуры();

	≈сли (Ѕуфер. оличество—трок()=0) “огда
		¬озврат;
	 онец≈сли;


	≈сть—обытие=0;
	//быстрые серии до 5 клавиш могут быть и у человека
	≈сли Ѕуфер. оличество—трок()<5 “огда
		Ѕуфер.¬начало();
		—обытие=—оздать—обытие(—ам(),,Ѕуфер. од лавиши,Ѕуфер.Alt,Ѕуфер.Shift,Ѕуфер.Ctrl);
		≈сть—обытие=1;
	 онец≈сли;
	Ѕуфер.”далить—троки();


	≈сли ≈сть—обытие=1 “огда
		глѕослать—обытие(—ам, —обытие);
		
		≈сли —обытие.ќбработано=0 “огда
			//нет обработчика нажатой клавиши по коду
			//преобразовываем в команду и оп€ть посылаем подписчикам
			 оманда=—ам.ѕолучить оманду( од омбинации);
			глѕослать оманду(—ам, оманда);
			
			≈сли —обытие.ќбработано=0 “огда
				// оманда в данный момент никому не нужна
				
			 онец≈сли;				
			
		 онец≈сли;	
	 онец≈сли;
 онецѕроцедуры

ѕроцедура ¬ключитьѕроверку лавиатуры() Ёкспорт

	—ервис.ќбработкаќжидани€("ќбработка лавиатуры",«адержка лавиатуры);
 онецѕроцедуры

ѕроцедура ќтключитьѕроверку лавиатуры() Ёкспорт

	—ервис.ќбработкаќжидани€("ќбработка лавиатуры",0);
 онецѕроцедуры


‘ункци€ «аписать() экспорт
	—ам().ѕодготовитьƒанные «аписи();
	возврат Ќастройки лавиатуры.«аписать();
 онец‘ункции


‘ункци€ ¬ыгрузить¬‘айл(»м€‘айла) экспорт
	—ам().ѕодготовитьƒанные «аписи();
	возврат Ќастройки лавиатуры.¬ыгрузить¬‘айл(»м€‘айла);
 онец‘ункции
